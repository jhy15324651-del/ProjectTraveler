<!-- templates/reviews.html -->
<div th:fragment="reviewsContent" class="container reviews">

    <div class="reviews-title-row">
        <h1 class="page-title">여행 후기</h1>

        <a class="write-btn" th:href="@{/reviews-post}" href="/reviews-post">
            후기 작성하기
        </a>
    </div>

    <!-- =========================
         필터 패널
    ========================== -->
    <!-- ✅ action 제거: 현재 페이지(/reviews-web or /reviews-unity)로 GET 재요청 -->
    <form id="filterForm" method="get">
        <section class="filter-panel">

            <!-- 여행 유형 (택1) -->
            <div class="filter-row">
                <div class="filter-label">
                    여행유형
                    <div class="filter-hint single">* 한 개만 선택</div>
                </div>
                <div class="filter-chips" data-key="type" data-mode="single">
                    <button type="button" class="chip active" data-value="">전체</button>
                    <button type="button" class="chip" data-value="solo">혼자</button>
                    <button type="button" class="chip" data-value="couple">커플</button>
                    <button type="button" class="chip" data-value="family">가족</button>
                    <button type="button" class="chip" data-value="friends">친구</button>
                </div>
                <input type="hidden" name="type" id="f_type" value="">
            </div>

            <!-- 테마 (택1) -->
            <div class="filter-row">
                <div class="filter-label">
                    테마
                    <div class="filter-hint single">* 한 개만 선택</div>
                </div>
                <div class="filter-chips" data-key="theme" data-mode="single">
                    <button type="button" class="chip active" data-value="">전체</button>
                    <button type="button" class="chip" data-value="freedom">자유</button>
                    <button type="button" class="chip" data-value="healing">힐링</button>
                    <button type="button" class="chip" data-value="food">맛집</button>
                    <button type="button" class="chip" data-value="activity">액티비티</button>
                    <button type="button" class="chip" data-value="nature">자연</button>
                </div>
                <input type="hidden" name="theme" id="f_theme" value="">
            </div>

            <!-- 예산 -->
            <div class="filter-row">
                <div class="filter-label">예산</div>

                <div class="reviews-budget">
                    <div class="reviews-budget-values">
                        <span id="budgetMinLabel">0원</span>
                        <span> ~ </span>
                        <span id="budgetMaxLabel">5,000,000원</span>
                    </div>

                    <div class="reviews-budget-slider">
                        <div class="reviews-budget-track">
                            <div class="reviews-budget-range" id="budgetRange"></div>
                        </div>

                        <input
                                type="range"
                                id="budgetMin"
                                min="0"
                                max="5000000"
                                step="100"
                                value="0"
                        />

                        <input
                                type="range"
                                id="budgetMax"
                                min="0"
                                max="5000000"
                                step="100"
                                value="5000000"
                        />
                    </div>

                    <div class="reviews-budget-ticks" id="budgetTicks"></div>

                    <!-- 서버로 전달될 값 -->
                    <input type="hidden" name="budgetMin" id="f_budgetMin" value="50000">
                    <input type="hidden" name="budgetMax" id="f_budgetMax" value="5000000">
                </div>
            </div>

            <!-- 기간 (복수 OR / prefix d_) -->
            <div class="filter-row">
                <div class="filter-label">
                    기간
                    <div class="filter-hint multi">* 중복 선택 가능</div>
                </div>

                <div class="filter-chips" data-key="period" data-mode="multi-or">
                    <button type="button" class="chip active" data-value="">전체</button>
                    <button type="button" class="chip" data-value="d_당일치기">당일</button>
                    <button type="button" class="chip" data-value="d_1박2일">1박2일</button>
                    <button type="button" class="chip" data-value="d_2박3일">2박3일</button>
                    <button type="button" class="chip" data-value="d_3박4일">3박4일</button>
                </div>
                <div id="periodInputs"></div>
            </div>

            <!-- 난이도 (복수 OR) -->
            <div class="filter-row">
                <div class="filter-label">
                    난이도
                    <div class="filter-hint multi">* 중복 선택 가능</div>
                </div>

                <div class="filter-chips" data-key="level" data-mode="multi-or">
                    <button type="button" class="chip active" data-value="">전체</button>
                    <button type="button" class="chip" data-value="lv_초급">초급</button>
                    <button type="button" class="chip" data-value="lv_중급">중급</button>
                    <button type="button" class="chip" data-value="lv_상급">상급</button>
                </div>
                <div id="levelInputs"></div>
            </div>

            <!-- 지역 -->
            <div class="filter-row region-row">
                <div class="filter-label">
                    지역
                    <div class="filter-hint multi">* 중복 선택 가능</div>
                </div>

                <div class="region-inline">
                    <div class="filter-chips" data-key="region" data-mode="multi-toggle">
                        <button type="button" class="chip active" data-value="">전체</button>
                        <button type="button" class="chip" data-value="r_도쿄">도쿄</button>
                        <button type="button" class="chip" data-value="r_오사카">오사카</button>
                        <button type="button" class="chip" data-value="r_교토">교토</button>
                        <button type="button" class="chip" data-value="r_후쿠오카">후쿠오카</button>
                        <button type="button" class="chip" data-value="r_삿포로">삿포로</button>
                    </div>
                </div>

                <div class="filter-hint sub one-line region-desc">
                    * 지역 중복 선택 시 선택한 지역이 모두 포함된 게시글이 먼저 보입니다.
                </div>

                <div id="regionInputs"></div>
            </div>

            <!-- ✅ 하단 검색 툴바 -->
            <div class="reviews search-toolbar">

                <div class="tag-summary-mini" id="miniSummary">
                    <span class="empty">선택된 조건 없음</span>
                </div>

                <select name="qField" class="q-field">
                    <option value="tc">제목 + 내용</option>
                    <option value="t">제목</option>
                    <option value="c">내용</option>
                </select>

                <textarea name="q" class="q-input" rows="1" placeholder="검색어를 입력하세요"></textarea>

                <button type="submit" class="q-btn">검색</button>
            </div>

        </section>
    </form>

    <!-- =========================
         게시글 리스트
    ========================== -->
    <section class="post-list">

        <article class="post-card" th:each="post : ${posts}">
            <a class="post-link" th:href="@{/reviews/{id}(id=${post.id})}">

                <div class="post-thumb">
                    <img th:if="${post.thumbnailUrl != null}"
                         th:src="${post.thumbnailUrl}"
                         alt="thumbnail"/>

                    <div th:if="${post.thumbnailUrl == null}"
                         class="post-thumb--placeholder">
                        No Image
                    </div>
                </div>

                <div class="post-body">

                    <h3 class="post-title" th:text="${post.title}">제목</h3>

                    <div class="post-meta">
                        <span class="badge"
                              th:if="${post.travelType != null}"
                              th:text="${post.travelType == 'solo' ? '혼자' :
                                         post.travelType == 'couple' ? '커플' :
                                         post.travelType == 'family' ? '가족' :
                                         post.travelType == 'friends' ? '친구' :
                                         post.travelType}">유형</span>

                        <span class="badge"
                              th:if="${post.theme != null}"
                              th:text="${post.theme == 'freedom' ? '자유여행' :
                                         post.theme == 'healing' ? '힐링' :
                                         post.theme == 'food' ? '맛집' :
                                         post.theme == 'activity' ? '액티비티' :
                                         post.theme == 'nature' ? '자연' :
                                         post.theme}">테마</span>

                        <span class="badge"
                              th:if="${post.period != null}"
                              th:text="${post.period}">기간</span>

                        <span class="badge"
                              th:if="${post.level != null}"
                              th:text="${post.level}">난이도</span>

                        <span class="badge"
                              th:each="tag : ${post.regionTags}"
                              th:text="${tag}">지역</span>

                        <span class="badge total"
                              th:text="|총액: ${#numbers.formatInteger(
        (post.budgetFlight  ?: 0)
      + (post.budgetLodging ?: 0)
      + (post.budgetFood   ?: 0)
      + (post.budgetExtra  ?: 0)
      , 0, 'COMMA')}만|">
                        </span>
                    </div>

                    <p class="post-desc"
                       th:text="${#strings.abbreviate(post.summary, 80)}">
                        요약
                    </p>

                </div>
            </a>
        </article>

        <div class="empty" th:if="${posts == null || #lists.isEmpty(posts)}">
            조건에 맞는 게시글이 없습니다.
        </div>

    </section>

</div>
