<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나의 강의실 - 일본 여행 LMS</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css">
</head>
<body class="main-page">

<!-- 헤더 -->
<div th:replace="fragments/main-header :: mainHeader"></div>

    <!-- 컨텐츠 -->
    <section class="content-section">
        <h2 class="section-title">나의 강의실</h2>
        <p class="section-subtitle">수강 중인 강좌와 학습 진도를 확인하세요</p>

        <!-- 학습 통계 (DB 연동) -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" th:text="${summary != null ? summary.inProgressCourseCount : 0}">0</div>
                <div class="stat-label">수강 중인 강좌</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${summary != null ? summary.completedCourseCount : 0}">0</div>
                <div class="stat-label">완료한 강좌</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${summary != null ? summary.averageProgressPercent + '%' : '0%'}">0%</div>
                <div class="stat-label">평균 진도율</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${summary != null ? summary.totalLearningTimeFormatted : '0분'}">0분</div>
                <div class="stat-label">총 학습 시간</div>
            </div>
        </div>

        <!-- 수강 중인 강좌 (DB 연동) -->
        <div class="table-container">
            <h3 style="margin-bottom: 20px; color: var(--dark-gray);">수강 중인 강좌</h3>

            <!-- 수강 중인 강좌가 없는 경우 -->
            <div th:if="${#lists.isEmpty(inProgressCourses)}" style="text-align: center; padding: 40px; color: #666;">
                <p>수강 중인 강좌가 없습니다.</p>
                <a th:href="@{/learning}" style="color: var(--primary-red);">강좌 둘러보기 →</a>
            </div>

            <table th:unless="${#lists.isEmpty(inProgressCourses)}">
                <thead>
                    <tr>
                        <th>강좌명</th>
                        <th>카테고리</th>
                        <th>진도율</th>
                        <th>마지막 학습일</th>
                        <th>상태</th>
                        <th>액션</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="enrollment : ${inProgressCourses}">
                        <td><strong th:text="${enrollment.courseTitle}">강좌명</strong></td>
                        <td th:text="${enrollment.courseCategory}">카테고리</td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" th:style="'width: ' + ${enrollment.progressPercent} + '%;'"></div>
                            </div>
                            <span style="font-size: 12px; color: #666;" th:text="${enrollment.progressPercent + '%'}">0%</span>
                        </td>
                        <td th:text="${enrollment.lastAccessedAt != null ? #temporals.format(enrollment.lastAccessedAt, 'yyyy-MM-dd') : '-'}">-</td>
                        <td><span class="badge badge-progress" th:text="${enrollment.statusDisplayName}">진행 중</span></td>
                        <td>
                            <a th:href="@{/lesson(courseId=${enrollment.courseId})}"
                               class="btn btn-primary" style="padding: 5px 15px; text-decoration: none;">
                                이어하기
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 완료한 강좌 (DB 연동) -->
        <div class="table-container" style="margin-top: 40px;">
            <h3 style="margin-bottom: 20px; color: var(--dark-gray);">완료한 강좌</h3>

            <!-- 완료한 강좌가 없는 경우 -->
            <div th:if="${#lists.isEmpty(completedCourses)}" style="text-align: center; padding: 40px; color: #666;">
                <p>아직 완료한 강좌가 없습니다.</p>
            </div>

            <table th:unless="${#lists.isEmpty(completedCourses)}">
                <thead>
                    <tr>
                        <th>강좌명</th>
                        <th>카테고리</th>
                        <th>완료일</th>
                        <th>학습 시간</th>
                        <th>상태</th>
                        <th>액션</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="enrollment : ${completedCourses}">
                        <td><strong th:text="${enrollment.courseTitle}">강좌명</strong></td>
                        <td th:text="${enrollment.courseCategory}">카테고리</td>
                        <td th:text="${enrollment.lastAccessedAt != null ? #temporals.format(enrollment.lastAccessedAt, 'yyyy-MM-dd') : '-'}">-</td>
                        <td th:text="${enrollment.totalWatchedFormatted}">0분</td>
                        <td><span class="badge badge-complete">완료</span></td>
                        <td>
                            <a th:href="@{/lesson(courseId=${enrollment.courseId})}"
                               class="btn btn-secondary" style="padding: 5px 15px; text-decoration: none;">
                                복습하기
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 승인 대기 중인 강좌 -->
        <div th:if="${!#lists.isEmpty(pendingCourses)}" class="table-container" style="margin-top: 40px;">
            <h3 style="margin-bottom: 20px; color: var(--dark-gray);">승인 대기 중</h3>
            <table>
                <thead>
                    <tr>
                        <th>강좌명</th>
                        <th>카테고리</th>
                        <th>신청일</th>
                        <th>상태</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="enrollment : ${pendingCourses}">
                        <td><strong th:text="${enrollment.courseTitle}">강좌명</strong></td>
                        <td th:text="${enrollment.courseCategory}">카테고리</td>
                        <td th:text="${enrollment.requestedAt != null ? #temporals.format(enrollment.requestedAt, 'yyyy-MM-dd') : '-'}">-</td>
                        <td><span class="badge" style="background: #fff3e0; color: #e65100;">승인 대기</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

<script th:src="@{/js/main.js}" src="/js/main.js"></script>
</body>
</html>