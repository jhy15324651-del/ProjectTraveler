<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나의 강의실 - 일본 여행 LMS</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css">
</head>
<body class="main-page">

<!-- 헤더 -->
<div th:replace="fragments/main-header :: mainHeader"></div>

    <!-- 컨텐츠 -->
    <section class="content-section">
        <h2 class="section-title">나의 강의실</h2>
        <p class="section-subtitle">수강 중인 강좌와 학습 진도를 확인하세요</p>

        <!-- 학습 통계 (DB 연동) -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" th:text="${summary != null ? summary.inProgressCourseCount : 0}">0</div>
                <div class="stat-label">수강 중인 강좌</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${summary != null ? summary.completedCourseCount : 0}">0</div>
                <div class="stat-label">완료한 강좌</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${summary != null ? summary.averageProgressPercent + '%' : '0%'}">0%</div>
                <div class="stat-label">평균 진도율</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${summary != null ? summary.totalLearningTimeFormatted : '0분'}">0분</div>
                <div class="stat-label">총 학습 시간</div>
            </div>
        </div>

        <!-- 수강 중인 강좌 (DB 연동) -->
        <div class="table-container">
            <h3 style="margin-bottom: 20px; color: var(--dark-gray);">수강 중인 강좌</h3>

            <!-- 수강 중인 강좌가 없는 경우 -->
            <div th:if="${#lists.isEmpty(inProgressCourses)}" style="text-align: center; padding: 40px; color: #666;">
                <p>수강 중인 강좌가 없습니다.</p>
                <a th:href="@{/learning}" style="color: var(--primary-red);">강좌 둘러보기 →</a>
            </div>

            <table th:unless="${#lists.isEmpty(inProgressCourses)}">
                <thead>
                    <tr>
                        <th>강좌명</th>
                        <th>카테고리</th>
                        <th>진도율</th>
                        <th>마지막 학습일</th>
                        <th>상태</th>
                        <th>액션</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="enrollment : ${inProgressCourses}">
                        <td><strong th:text="${enrollment.courseTitle}">강좌명</strong></td>
                        <td th:text="${enrollment.courseCategory}">카테고리</td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" th:style="'width: ' + ${enrollment.progressPercent} + '%;'"></div>
                            </div>
                            <span style="font-size: 12px; color: #666;" th:text="${enrollment.progressPercent + '%'}">0%</span>
                        </td>
                        <td th:text="${enrollment.lastAccessedAt != null ? #temporals.format(enrollment.lastAccessedAt, 'yyyy-MM-dd') : '-'}">-</td>
                        <td><span class="badge badge-progress" th:text="${enrollment.statusDisplayName}">진행 중</span></td>
                        <td>
                            <a th:href="@{/lesson(courseId=${enrollment.courseId})}"
                               class="btn btn-primary" style="padding: 5px 15px; text-decoration: none;">
                                이어하기
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 완료한 강좌 (DB 연동) -->
        <div class="table-container" style="margin-top: 40px;">
            <h3 style="margin-bottom: 20px; color: var(--dark-gray);">완료한 강좌</h3>

            <!-- 완료한 강좌가 없는 경우 -->
            <div th:if="${#lists.isEmpty(completedCourses)}" style="text-align: center; padding: 40px; color: #666;">
                <p>아직 완료한 강좌가 없습니다.</p>
            </div>

            <table th:unless="${#lists.isEmpty(completedCourses)}">
                <thead>
                    <tr>
                        <th>강좌명</th>
                        <th>카테고리</th>
                        <th>완료일</th>
                        <th>학습 시간</th>
                        <th>상태</th>
                        <th>액션</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="enrollment : ${completedCourses}">
                        <td><strong th:text="${enrollment.courseTitle}">강좌명</strong></td>
                        <td th:text="${enrollment.courseCategory}">카테고리</td>
                        <td th:text="${enrollment.lastAccessedAt != null ? #temporals.format(enrollment.lastAccessedAt, 'yyyy-MM-dd') : '-'}">-</td>
                        <td th:text="${enrollment.totalWatchedFormatted}">0분</td>
                        <td><span class="badge badge-complete">완료</span></td>
                        <td>
                            <a th:href="@{/lesson(courseId=${enrollment.courseId})}"
                               class="btn btn-secondary" style="padding: 5px 15px; text-decoration: none;">
                                복습하기
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 승인 대기 중인 강좌 -->
        <div th:if="${!#lists.isEmpty(pendingCourses)}" class="table-container" style="margin-top: 40px;">
            <h3 style="margin-bottom: 20px; color: var(--dark-gray);">승인 대기 중</h3>
            <table>
                <thead>
                    <tr>
                        <th>강좌명</th>
                        <th>카테고리</th>
                        <th>신청일</th>
                        <th>상태</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="enrollment : ${pendingCourses}">
                        <td><strong th:text="${enrollment.courseTitle}">강좌명</strong></td>
                        <td th:text="${enrollment.courseCategory}">카테고리</td>
                        <td th:text="${enrollment.requestedAt != null ? #temporals.format(enrollment.requestedAt, 'yyyy-MM-dd') : '-'}">-</td>
                        <td><span class="badge" style="background: #fff3e0; color: #e65100;">승인 대기</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 수료증 목록 -->
        <div class="table-container" style="margin-top: 40px;">
            <h3 style="margin-bottom: 20px; color: var(--dark-gray);">
                수료증
                <span th:if="${certificateCount > 0}" style="font-size: 14px; color: #666; font-weight: normal;"
                      th:text="'(' + ${certificateCount} + '개)'"></span>
            </h3>

            <!-- 수료증이 없는 경우 -->
            <div th:if="${#lists.isEmpty(certificates)}" style="text-align: center; padding: 40px; color: #666; background: #f9f9f9; border-radius: 8px;">
                <div style="font-size: 48px; margin-bottom: 16px;">🏆</div>
                <p style="margin-bottom: 8px;">아직 발급받은 수료증이 없습니다.</p>
                <p style="font-size: 14px;">승인형 강좌를 수강하고 진도율 90% + 퀴즈 90% 이상 달성 시 수료증이 발급됩니다.</p>
            </div>

            <!-- 수료증 카드 그리드 -->
            <div th:unless="${#lists.isEmpty(certificates)}" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                <div th:each="cert : ${certificates}"
                     style="background: linear-gradient(135deg, #fff9e6 0%, #fff 100%); border: 1px solid #e0d5b8; border-radius: 12px; padding: 24px; position: relative; overflow: hidden;">
                    <!-- 수료 마크 -->
                    <div style="position: absolute; top: 16px; right: 16px; width: 48px; height: 48px; background: #ffd700; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);">
                        🎓
                    </div>

                    <div style="margin-bottom: 16px;">
                        <h4 style="font-size: 18px; font-weight: 600; color: #333; margin-bottom: 8px; padding-right: 60px;"
                            th:text="${cert.courseTitle}">강좌명</h4>
                        <p style="font-size: 12px; color: #888;" th:text="'발급번호: ' + ${cert.certificateNumber}">CERT-XXXXXXXX</p>
                    </div>

                    <div style="display: flex; gap: 20px; margin-bottom: 16px; font-size: 14px;">
                        <div>
                            <span style="color: #666;">진도율</span>
                            <strong style="display: block; color: #4caf50;" th:text="${cert.progressPercent + '%'}">100%</strong>
                        </div>
                        <div>
                            <span style="color: #666;">퀴즈</span>
                            <strong style="display: block; color: #2196f3;" th:text="${cert.quizPercent + '%'}">100%</strong>
                        </div>
                        <div>
                            <span style="color: #666;">발급일</span>
                            <strong style="display: block; color: #333;" th:text="${cert.issuedAt}">2024.01.01</strong>
                        </div>
                    </div>

                    <div style="display: flex; gap: 8px;">
                        <a th:href="@{/lesson(courseId=${cert.courseId})}"
                           style="flex: 1; padding: 10px; text-align: center; background: #f5f5f5; color: #333; border-radius: 6px; text-decoration: none; font-size: 14px;">
                            복습하기
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

<script th:src="@{/js/main.js}" src="/js/main.js"></script>
</body>
</html>