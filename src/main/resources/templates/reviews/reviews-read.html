<!-- templates/reviews/reviews-read.html -->
<div th:fragment="reviewsReadContent" class="container reviews">

    <section class="post-read">

        <!-- 상단 타이틀/버튼 -->
        <div class="reviews-title-row">
            <h1 class="page-title"
                th:text="${post != null ? post.title : '제목 없음'}">제목</h1>

            <!-- 버튼 묶음 -->
            <div class="actions">
                <!-- ✅ 수정: 작성자만 -->
                <a class="write-btn edit-btn"
                   th:if="${canEdit}"
                   th:href="${isUnity == true}
        ? @{/reviews-unity/{id}/edit(id=${post.id})}
        : @{/reviews/{id}/edit(id=${post.id})}">
                    ✏ 수정
                </a>


                <!-- ✅ 삭제: 작성자 + ADMIN -->
                <form th:if="${canDelete}"
                      th:action="${isUnity == true}
                           ? @{/reviews-unity/{id}/delete(id=${post.id})}
                           : @{/reviews/{id}/delete(id=${post.id})}"
                      method="post"
                      style="display:inline;">
                    <!-- ✅ Spring Security CSRF -->
                    <input type="hidden"
                           th:if="${_csrf != null}"
                           th:name="${_csrf.parameterName}"
                           th:value="${_csrf.token}"/>

                    <!-- ✅ 삭제: 작성자 + ADMIN (JS fetch로 처리) -->
                    <button type="button"
                            class="write-btn delete-btn"
                            th:if="${canDelete}"
                            th:attr="data-delete-url=${isUnity}
                        ? @{/reviews-unity/{id}/delete(id=${post.id})}
                         : @{/reviews/{id}/delete(id=${post.id})}">
                        🗑 삭제
                    </button>

                </form>

                <!-- ✅ 목록 -->
                <a class="write-btn"
                   th:href="${isUnity == true} ? @{/reviews-unity} : @{/reviews}">
                    ← 목록으로
                </a>
            </div>
        </div>

        <!-- 작성자 / 날짜 -->
        <div class="post-meta" style="margin-top: 8px;">
            <span th:text="${
                post.writer != null
                  ? (post.writer.fullName != null ? post.writer.fullName
                      : (post.writer.username != null ? post.writer.username : '익명'))
                  : '익명'
            }">작성자</span>

            <span> · </span>

            <span th:text="${post.createdAt != null ? #temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm') : ''}">
                2026-01-27 16:40
            </span>
        </div>

        <!-- 메타 칩들 -->
        <div class="post-meta" style="margin-top: 12px; display:flex; gap:8px; flex-wrap:wrap;">

            <!-- 여행유형 -->
            <span class="chip"
                  th:if="${post.travelType != null and !post.travelType.isEmpty()}"
                  th:text="${
                      post.travelType == 'solo'    ? '혼자' :
                      post.travelType == 'couple'  ? '커플' :
                      post.travelType == 'family'  ? '가족' :
                      post.travelType == 'friends' ? '친구' :
                      post.travelType
                  }">유형</span>

            <!-- 테마(다중) -->
            <th:block th:if="${post.themes != null and !post.themes.isEmpty()}">
                <span class="chip"
                     th:each="thm : ${post.themes}"
                     th:text="${thm == 'freedom'  ? '자유여행' :
                                thm == 'healing'  ? '힐링' :
                                thm == 'food'     ? '맛집' :
                                thm == 'activity' ? '액티비티' :
                                thm == 'nature'   ? '자연' :
                                thm}">테마</span>
            </th:block>
            <!-- 기간 -->
            <span class="chip"
                  th:if="${post.period != null and !post.period.isEmpty()}"
                  th:text="${post.period}">기간</span>

            <!-- 난이도 -->
            <span class="chip"
                  th:if="${post.level != null and !post.level.isEmpty()}"
                  th:text="${post.level}">난이도</span>

            <!-- 지역 태그들 -->
            <span class="chip"
                  th:if="${post.regionTags != null}"
                  th:each="tag : ${post.regionTags}"
                  th:text="${tag}">지역</span>
        </div>

        <!-- 예산 -->
        <div class="post-budget" style="margin-top: 14px;">
            <div>
                항공: <b th:text="${post.budgetFlight  ?: 0}">0</b>만 /
                숙박: <b th:text="${post.budgetLodging ?: 0}">0</b>만 /
                식비: <b th:text="${post.budgetFood   ?: 0}">0</b>만 /
                기타: <b th:text="${post.budgetExtra  ?: 0}">0</b>만
            </div>

            <div style="margin-top: 6px;">
                사용 금액:
                <b th:text="${
                    (post.budgetFlight  ?: 0)
                  + (post.budgetLodging ?: 0)
                  + (post.budgetFood   ?: 0)
                  + (post.budgetExtra  ?: 0)
                }">0</b>만 원
            </div>
        </div>

        <hr style="margin:18px 0; border:0; border-top:1px solid #e5e7eb;">

        <!-- ✅ Quill HTML 본문 렌더링 -->
        <article class="post-content" th:utext="${post.content}">
            본문
        </article>

    </section>

</div>
