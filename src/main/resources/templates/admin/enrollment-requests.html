<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수강 승인 관리 - 관리자</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css">
    <style>
        .admin-container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
        .admin-title { font-size: 24px; font-weight: 700; margin-bottom: 30px; }
        .admin-table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .admin-table th, .admin-table td { padding: 16px; text-align: left; border-bottom: 1px solid #eee; }
        .admin-table th { background: #f8f9fa; font-weight: 600; color: #333; }
        .admin-table tr:last-child td { border-bottom: none; }
        .btn-approve { background: #4caf50; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; margin-right: 8px; }
        .btn-reject { background: #f44336; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
        .btn-approve:hover { background: #43a047; }
        .btn-reject:hover { background: #e53935; }
        .empty-message { text-align: center; padding: 60px 20px; color: #666; }
        .admin-nav { margin-bottom: 30px; display: flex; gap: 15px; }
        .admin-nav a { padding: 10px 20px; background: #f5f5f5; border-radius: 8px; text-decoration: none; color: #333; }
        .admin-nav a.active { background: var(--primary-red); color: white; }
    </style>
</head>
<body class="main-page">
<div th:replace="fragments/main-header :: mainHeader"></div>

<div class="admin-container">
    <h1 class="admin-title">수강 승인 관리</h1>

    <div class="admin-nav">
        <a th:href="@{/admin/courses}" href="/admin/courses">강좌 관리</a>
        <a th:href="@{/admin/enrollments/requests}" href="/admin/enrollments/requests" class="active">수강 승인</a>
        <a th:href="@{/admin/enrollments/assign}" href="/admin/enrollments/assign">강좌 배정</a>
    </div>

    <table class="admin-table" th:if="${!#lists.isEmpty(enrollments)}">
        <thead>
            <tr>
                <th>신청자</th>
                <th>강좌명</th>
                <th>신청일</th>
                <th>상태</th>
                <th>액션</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="e : ${enrollments}">
                <td>
                    <strong th:text="${e.userFullName}">사용자</strong>
                    <br><small style="color: #666;" th:text="${e.username}">username</small>
                </td>
                <td th:text="${e.courseTitle}">강좌명</td>
                <td th:text="${#temporals.format(e.requestedAt, 'yyyy-MM-dd HH:mm')}">2024-01-01 10:00</td>
                <td th:text="${e.statusDisplayName}">승인 대기</td>
                <td>
                    <button class="btn-approve" th:onclick="|approve(${e.id})|">승인</button>
                    <button class="btn-reject" th:onclick="|reject(${e.id})|">반려</button>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="empty-message" th:if="${#lists.isEmpty(enrollments)}">
        승인 대기 중인 수강 신청이 없습니다.
    </div>
</div>

<script>
    async function approve(id) {
        if (!confirm('승인하시겠습니까?')) return;

        try {
            const response = await fetch(`/admin/enrollments/api/${id}/approve`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({})
            });
            const result = await response.json();
            alert(result.message);
            if (result.success) location.reload();
        } catch (e) {
            alert('오류가 발생했습니다.');
        }
    }

    async function reject(id) {
        const note = prompt('반려 사유를 입력하세요 (선택):');
        if (note === null) return;

        try {
            const response = await fetch(`/admin/enrollments/api/${id}/reject`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ note: note })
            });
            const result = await response.json();
            alert(result.message);
            if (result.success) location.reload();
        } catch (e) {
            alert('오류가 발생했습니다.');
        }
    }
</script>
</body>
</html>
