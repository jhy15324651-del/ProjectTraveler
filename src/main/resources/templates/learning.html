<!-- templates/fragments/learning-content.html -->
<div th:fragment="learningContent">

    <!-- 학습하기 헤더 섹션 -->
    <section class="learn-hero">
        <div class="learn-hero-content">
            <h1 class="learn-hero-title">학습하기</h1>
            <p class="learn-hero-subtitle">기초 회화부터 실전 일본어까지, 일본 여행을 위한 체계적인 학습을 시작하세요</p>
        </div>
    </section>

    <!-- 카테고리별 더보기 (향후 확장) -->
    <section class="learn-section learn-section-categories">
        <div class="learn-section-header">
            <h2 class="learn-section-title">카테고리별 학습</h2>
            <p class="learn-section-subtitle">관심 분야를 선택하여 학습하세요</p>
        </div>

        <div class="learn-category-grid">
            <div class="learn-category-card" data-category="language">
                <div class="learn-category-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                    </svg>
                </div>
                <h3 class="learn-category-title">일본어</h3>
                <p class="learn-category-count">5개 강좌</p>
            </div>

            <div class="learn-category-card" data-category="culture">
                <div class="learn-category-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M2 12h20"/>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                    </svg>
                </div>
                <h3 class="learn-category-title">문화</h3>
                <p class="learn-category-count">3개 강좌</p>
            </div>

            <div class="learn-category-card" data-category="travel">
                <div class="learn-category-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                </div>
                <h3 class="learn-category-title">여행</h3>
                <p class="learn-category-count">4개 강좌</p>
            </div>
        </div>
    </section>

    <!-- 추천 강의 섹션 -->
    <section class="learn-section">
        <div class="learn-section-header">
            <!-- (원본 유지: 비어있음) -->
        </div>

        <!-- 강의 카드 그리드 - DB에서 가져온 실제 강좌 표시 -->
        <div class="learn-course-grid">

            <!-- 강좌가 없는 경우 -->
            <div th:if="${#lists.isEmpty(courses)}"
                 style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #666;">
                <p>등록된 강좌가 없습니다.</p>
            </div>

            <!-- ✅ course-detail 이동: 웹/유니티 분기 -->
            <a th:each="item : ${courses}"
               th:href="${isUnity} ? @{/course-detail-unity(id=${item.course.id})} : @{/course-detail(id=${item.course.id})}"
               class="learn-course-card"
               th:data-course-id="${item.course.id}"
               th:data-category="${item.course.category != null ? item.course.category.name().toLowerCase() : 'etc'}">

                <div class="learn-course-thumbnail"
                     th:style="'background-image: url(' + ${item.course.thumbnailUrl != null ? item.course.thumbnailUrl : 'https://images.unsplash.com/photo-1528164344705-47542687000d?w=800'} + ');'">

                    <!-- 수강 상태 뱃지 -->
                    <span th:if="${item.enrollment != null and item.enrollment.status.name() == 'REQUESTED'}"
                          class="learn-course-badge" style="background: #ff9800;">승인대기</span>

                    <span th:if="${item.enrollment != null and item.enrollment.isAccessible() and item.progressPercent >= 100}"
                          class="learn-course-badge" style="background: #4caf50;">완료</span>

                    <!-- 진도 표시 (수강 중인 경우만) -->
                    <div th:if="${item.enrollment != null and item.enrollment.isAccessible() and item.progressPercent > 0 and item.progressPercent < 100}"
                         class="learn-course-progress-indicator" th:data-progress="${item.progressPercent}">
                        <div class="learn-progress-ring" th:classappend="${item.progressPercent >= 90 ? 'learn-progress-almost' : ''}">
                            <svg viewBox="0 0 36 36">
                                <path class="learn-progress-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="learn-progress-fill"
                                      th:attr="stroke-dasharray=${item.progressPercent + ', 100'}"
                                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            </svg>
                            <span class="learn-progress-text" th:text="${item.progressPercent + '%'}">0%</span>
                        </div>
                    </div>
                </div>

                <div class="learn-course-body">
                    <h3 class="learn-course-title" th:text="${item.course.title}">강좌명</h3>
                    <p class="learn-course-desc"
                       th:text="${item.course.shortDesc != null ? item.course.shortDesc : '강좌 설명이 없습니다.'}">강좌 설명</p>

                    <div class="learn-course-meta">
                        <span class="learn-meta-item">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                            <span th:text="${item.course.totalLessonCount + '개 레슨'}">0개 레슨</span>
                        </span>

                        <span class="learn-meta-item">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            <span th:text="${item.course.formattedDuration}">미정</span>
                        </span>

                        <span class="learn-meta-item"
                              th:classappend="${item.course.level != null and item.course.level.name() == 'BEGINNER' ? 'learn-level-beginner' : (item.course.level != null and item.course.level.name() == 'INTERMEDIATE' ? 'learn-level-intermediate' : 'learn-level-advanced')}"
                              th:text="${item.course.levelDisplayName}">입문</span>
                    </div>

                    <!-- 상태에 따른 액션 버튼 -->
                    <div class="learn-course-action">
                        <!-- 미수강: 수강신청 버튼 -->
                        <button th:if="${item.enrollment == null}"
                                class="learn-enroll-btn"
                                th:classappend="${item.course.enrollPolicy != null and item.course.enrollPolicy.name() == 'SELF' ? 'btn-instant' : ''}"
                                th:data-course-id="${item.course.id}"
                                th:data-policy="${item.course.enrollPolicy != null ? item.course.enrollPolicy.name() : 'SELF'}"
                                onclick="requestEnrollment(event, this)">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            <th:block th:if="${item.course.enrollPolicy != null and item.course.enrollPolicy.name() == 'SELF'}">바로 수강</th:block>
                            <th:block th:if="${item.course.enrollPolicy == null or item.course.enrollPolicy.name() != 'SELF'}">수강 신청</th:block>
                        </button>

                        <!-- 승인 대기 중 -->
                        <span th:if="${item.enrollment != null and item.enrollment.status.name() == 'REQUESTED'}"
                              class="learn-status-badge pending">승인 대기 중</span>

                        <!-- 수강 가능: 학습 시작/이어하기 -->
                        <span th:if="${item.enrollment != null and item.enrollment.isAccessible() and item.progressPercent == 0}"
                              class="learn-course-link">학습 시작하기 &gt;</span>
                        <span th:if="${item.enrollment != null and item.enrollment.isAccessible() and item.progressPercent > 0 and item.progressPercent < 100}"
                              class="learn-course-link">이어서 학습하기 &gt;</span>
                        <span th:if="${item.enrollment != null and item.enrollment.isAccessible() and item.progressPercent >= 100}"
                              class="learn-course-link">복습하기 &gt;</span>
                    </div>
                </div>
            </a>
        </div>
    </section>

    <!-- ✅ JS에서 필요하면 쓰라고 isUnity도 같이 내려줌 (원본 유지) -->
    <input type="hidden" id="isUnity" th:value="${isUnity}">
</div>