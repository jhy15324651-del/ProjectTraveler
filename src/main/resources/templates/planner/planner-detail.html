<!-- templates/planner/planner-detail.html - 플래너 상세 콘텐츠 (fragment) -->
<main th:fragment="plannerDetailContent" class="planner-detail-page">
    <!-- 플래너 헤더 -->
    <div class="planner-detail-header">
        <div class="planner-detail-header-bg">
            <img th:if="${planner.coverImage != null and !planner.coverImage.isEmpty()}"
                 th:src="${planner.coverImage}"
                 th:alt="${planner.title}">
            <img th:unless="${planner.coverImage != null and !planner.coverImage.isEmpty()}"
                 src="https://images.unsplash.com/photo-1480796927426-f609979314bd?w=1200&q=80"
                 th:alt="${planner.title}">
        </div>
        <div class="planner-detail-header-content">
            <!-- ⭐ 돌아가기 버튼 -->
            <a class="planner-back-link"
               th:href="${isUnity} ? @{/planner-unity} : @{/planner}"
               href="/planner">
                <svg width="20" height="20" viewBox="0 0 24 24"
                     fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                메인으로 돌아가기
            </a>
            <h1 class="planner-detail-title" th:text="${planner.title}">플래너 제목</h1>
            <div class="planner-detail-meta">
                <div class="planner-detail-meta-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                    <span th:text="${planner.destination != null ? planner.destination : '목적지 미설정'}">목적지</span>
                </div>
                <div class="planner-detail-meta-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    <span th:if="${planner.startDate != null and planner.endDate != null}"
                          th:text="${#temporals.format(planner.startDate, 'yyyy-MM-dd')} + ' ~ ' + ${#temporals.format(planner.endDate, 'yyyy-MM-dd')}">
                        날짜
                    </span>
                    <span th:unless="${planner.startDate != null and planner.endDate != null}">날짜 미설정</span>
                </div>
            </div>
            <p class="planner-detail-desc" th:if="${planner.description != null and !planner.description.isEmpty()}"
               th:text="${planner.description}"></p>
        </div>
    </div>

    <!-- 플래너 본문 -->
    <div class="planner-detail-body">
        <!-- 툴바 -->
        <div class="planner-detail-toolbar">
            <!-- Day 탭 -->
            <div class="day-tabs" id="dayTabs">
                <th:block th:if="${planner.days > 0}">
                    <button type="button" th:each="day, stat : ${#numbers.sequence(1, planner.days)}"
                            th:class="'day-tab' + (${stat.index == 0} ? ' active' : '')"
                            th:data-day="${stat.index}"
                            th:onclick="'selectDay(' + ${stat.index} + ')'">
                        <span class="day-tab-label" th:text="'Day ' + ${day}">Day 1</span>
                        <span class="day-tab-date"
                              th:text="${#temporals.format(planner.startDate.plusDays(stat.index), 'M/d')}">3/20</span>
                    </button>
                </th:block>
                <th:block th:unless="${planner.days > 0}">
                    <button type="button" class="day-tab active" data-day="0" onclick="selectDay(0)">
                        <span class="day-tab-label">Day 1</span>
                        <span class="day-tab-date">-</span>
                    </button>
                </th:block>
            </div>

            <!-- 액션 버튼 -->
            <div class="planner-detail-actions" th:if="${canEdit}">
                <!-- 공개 설정 토글 (소유자만) -->
                <div class="visibility-toggle" id="visibilityToggle" th:if="${isOwner}">
                    <span class="visibility-toggle-label">공개 설정</span>
                    <label class="visibility-toggle-switch">
                        <input type="checkbox" id="visibilitySwitch"
                               th:checked="${planner.visibility.name() == 'PUBLIC'}"
                               onchange="toggleVisibility()">
                        <span class="visibility-toggle-slider"></span>
                    </label>
                    <span class="visibility-toggle-status" id="visibilityStatus"
                          th:text="${planner.visibility.name() == 'PUBLIC' ? '공개' : '비공개'}"
                          th:class="'visibility-toggle-status' + (${planner.visibility.name() == 'PUBLIC'} ? ' public' : '')">비공개</span>
                </div>

                <button type="button" class="btn-planner-action primary" onclick="savePlanner()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    저장
                </button>
                <button type="button" class="btn-planner-action secondary" onclick="openShareModal()" th:if="${isOwner}">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="18" cy="5" r="3"/>
                        <circle cx="6" cy="12" r="3"/>
                        <circle cx="18" cy="19" r="3"/>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                    </svg>
                    공유
                </button>
                <button type="button" class="btn-planner-action secondary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    PDF
                </button>
                <button type="button" class="btn-planner-action danger" onclick="deletePlanner()" th:if="${isOwner}">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                    삭제
                </button>
            </div>
            <!-- 읽기 전용 안내 -->
            <div class="planner-detail-readonly" th:unless="${canEdit}">
                <span class="readonly-badge">읽기 전용</span>
            </div>
        </div>

        <!-- 레이아웃 -->
        <div class="planner-detail-layout">
            <!-- 일정 섹션 -->
            <div class="itinerary-section">
                <div class="itinerary-header">
                    <h3>일정</h3>
                    <button type="button" class="btn-add-itinerary" onclick="openAddItineraryModal()" th:if="${canEdit}">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        일정 추가
                    </button>
                </div>

                <!-- 일정 목록 -->
                <div class="itinerary-list" id="itineraryList">
                    <!-- 일정이 없는 경우 -->
                    <div class="itinerary-empty" id="itineraryEmpty" th:if="${#lists.isEmpty(itineraries)}">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        <p>등록된 일정이 없습니다.</p>
                        <p th:if="${canEdit}">위의 '일정 추가' 버튼을 눌러 일정을 추가해보세요.</p>
                    </div>

                    <!-- 일정 카드들 -->
                    <div th:each="item : ${itineraries}"
                         class="itinerary-card"
                         th:data-day="${item.dayIndex}"
                         th:data-id="${item.id}"
                         th:style="${item.dayIndex != 0} ? 'display:none;' : ''">
                        <div class="itinerary-card-header">
                            <div class="itinerary-checkbox"
                                 th:classappend="${item.completed} ? 'checked' : ''"
                                 th:if="${canEdit}"
                                 th:onclick="'toggleItineraryComplete(' + ${item.id} + ', this)'">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
                                     th:style="${item.completed} ? 'width:12px;height:12px;display:block;' : 'width:12px;height:12px;display:none;'">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                            <div class="itinerary-card-main">
                                <div class="itinerary-time-category">
                                    <div class="itinerary-time" th:if="${item.time != null and !item.time.isEmpty()}">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"/>
                                            <polyline points="12 6 12 12 16 14"/>
                                        </svg>
                                        <span th:text="${item.time}">09:00</span>
                                    </div>
                                    <span class="itinerary-category"
                                          th:classappend="${item.categoryClassName}"
                                          th:text="${item.categoryDisplayName}">관광지</span>
                                </div>
                                <div class="itinerary-title" th:text="${item.title}">일정 제목</div>
                                <div class="itinerary-location" th:if="${item.location != null and !item.location.isEmpty()}">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                        <circle cx="12" cy="10" r="3"/>
                                    </svg>
                                    <span th:text="${item.location}">위치</span>
                                </div>
                                <div class="itinerary-notes" th:if="${item.notes != null and !item.notes.isEmpty()}"
                                     th:text="${item.notes}">메모</div>
                                <!-- 일정 이미지 -->
                                <div class="itinerary-image" th:if="${item.imageUrl != null and !item.imageUrl.isEmpty()}">
                                    <img th:src="${item.imageUrl}" th:alt="${item.title}">
                                </div>
                                <div class="itinerary-cost" th:if="${item.cost != null and item.cost > 0}">
                                    <span class="cost-label">예상비용 :</span>
                                    <span class="cost-amount" th:data-krw="${item.cost}"
                                          th:text="'₩' + ${#numbers.formatInteger(item.cost, 1, 'COMMA')}">₩0</span>
                                </div>
                            </div>
                            <!-- 수정 버튼 -->
                            <button type="button" class="btn-edit-itinerary"
                                    th:if="${canEdit}"
                                    th:onclick="'openEditItineraryModal(' + ${item.id} + ')'">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                                수정
                            </button>
                            <button type="button" class="btn-delete-itinerary"
                                    th:if="${canEdit}"
                                    th:onclick="'deleteItinerary(' + ${item.id} + ')'">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                                삭제
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 사이드바 -->
            <div class="planner-sidebar">
                <div class="sidebar-card">
                    <div class="sidebar-tabs">
                        <button type="button" class="sidebar-tab active" data-tab="checklist" onclick="switchSidebarTab('checklist')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="9 11 12 14 22 4"/>
                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                            </svg>
                            체크리스트
                        </button>
                        <button type="button" class="sidebar-tab" data-tab="budget" onclick="switchSidebarTab('budget')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                <line x1="1" y1="10" x2="23" y2="10"/>
                            </svg>
                            예산
                        </button>
                    </div>

                    <!-- 체크리스트 탭 -->
                    <div class="sidebar-content" id="checklistTab" style="display: flex;">
                        <div class="checklist-progress">
                            <div class="checklist-progress-header">
                                <span>진행률</span>
                                <span id="checklistCount"
                                      th:text="${completedChecklist} + '/' + ${totalChecklist}">0/0</span>
                            </div>
                            <div class="checklist-progress-bar">
                                <div class="checklist-progress-fill" id="checklistProgressBar"
                                     th:style="'width: ' + (${totalChecklist > 0} ? (${completedChecklist * 100 / totalChecklist}) : 0) + '%'"></div>
                            </div>
                        </div>

                        <div class="checklist-items" id="checklistItems">
                            <!-- 체크리스트가 없는 경우 -->
                            <div class="checklist-empty" th:if="${#lists.isEmpty(checklists)}">
                                <p>체크리스트가 비어 있습니다.</p>
                            </div>
                            <!-- 체크리스트 항목들 -->
                            <label class="checklist-item" th:each="item : ${checklists}">
                                <input type="checkbox"
                                       th:checked="${item.completed}"
                                       th:disabled="${!canEdit}"
                                       th:onchange="'toggleChecklistItem(' + ${item.id} + ', this)'">
                                <div class="checklist-item-content">
                                    <div class="checklist-item-category" th:if="${item.category != null}"
                                         th:text="${item.category}">카테고리</div>
                                    <div class="checklist-item-text"
                                         th:classappend="${item.completed} ? 'completed' : ''"
                                         th:text="${item.text}">항목</div>
                                </div>
                                <button type="button" class="btn-delete-checklist"
                                        th:if="${canEdit}"
                                        th:onclick="'deleteChecklistItem(' + ${item.id} + ', event)'">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                    </svg>
                                </button>
                            </label>
                        </div>

                        <div class="checklist-add" th:if="${canEdit}">
                            <input type="text" id="newChecklistItem" placeholder="새 항목 추가..." onkeydown="if(event.key==='Enter') addChecklistItem()">
                            <button type="button" onclick="addChecklistItem()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px;">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- 예산 탭 -->
                    <div class="sidebar-content" id="budgetTab" style="display: none;">
                        <!-- 통화 선택기 (화면 표시용) -->
                        <div class="currency-selector">
                            <span class="currency-selector-label">표시 통화</span>
                            <div class="currency-options">
                                <label class="currency-option">
                                    <input type="radio" name="displayCurrency" value="KRW" checked
                                           onchange="switchDisplayCurrency('KRW')">
                                    <span class="currency-option-label">₩ 원</span>
                                </label>
                                <label class="currency-option">
                                    <input type="radio" name="displayCurrency" value="USD"
                                           onchange="switchDisplayCurrency('USD')">
                                    <span class="currency-option-label">$ 달러</span>
                                </label>
                                <label class="currency-option">
                                    <input type="radio" name="displayCurrency" value="JPY"
                                           onchange="switchDisplayCurrency('JPY')">
                                    <span class="currency-option-label">¥ 엔</span>
                                </label>
                            </div>
                        </div>

                        <div class="budget-summary">
                            <div class="budget-summary-label">총 예산</div>
                            <!-- 편집 가능한 경우 입력 필드 표시 -->
                            <div class="budget-summary-total" th:if="${canEdit}">
                                <span class="budget-currency" id="budgetCurrencySymbol">₩</span>
                                <input type="number"
                                       id="totalBudgetInput"
                                       th:value="${totalBudget}"
                                       th:data-krw="${totalBudget}"
                                       onchange="updateTotalBudget(this.value)"
                                       placeholder="0">
                            </div>
                            <!-- 편집 불가능한 경우 텍스트만 표시 -->
                            <div class="budget-summary-total currency-amount" th:unless="${canEdit}"
                                 th:data-krw="${totalBudget}"
                                 th:text="'₩' + ${#numbers.formatInteger(totalBudget, 1, 'COMMA')}">₩0</div>
                            <div class="budget-summary-detail" id="budgetSummaryDetail"
                                 th:data-used-krw="${totalActual}"
                                 th:data-remaining-krw="${totalRemaining}">
                                <span>사용: <span class="currency-amount" th:data-krw="${totalActual}" th:text="'₩' + ${#numbers.formatInteger(totalActual, 1, 'COMMA')}">₩0</span></span>
                                <span> | 남음: <span class="currency-amount" th:data-krw="${totalRemaining}" th:text="'₩' + ${#numbers.formatInteger(totalRemaining, 1, 'COMMA')}">₩0</span></span>
                            </div>
                        </div>

                        <!-- 예산 상세 내역 -->
                        <div class="budget-detail-breakdown">
                            <div class="budget-breakdown-item">
                                <span class="breakdown-label">일정 예상비용</span>
                                <span class="breakdown-value currency-amount" id="itineraryCostTotalDisplay"
                                      th:data-krw="${itineraryCostTotal}"
                                      th:text="'₩' + ${#numbers.formatInteger(itineraryCostTotal, 1, 'COMMA')}">₩0</span>
                            </div>
                            <div class="budget-breakdown-item total">
                                <span class="breakdown-label">남은 예산</span>
                                <span class="breakdown-value currency-amount" id="remainingBudgetDisplay"
                                      th:data-krw="${totalRemaining}"
                                      th:classappend="${totalRemaining < 0} ? ' negative' : ''"
                                      th:text="'₩' + ${#numbers.formatInteger(totalRemaining, 1, 'COMMA')}">₩0</span>
                            </div>
                        </div>

                        <!-- 카테고리별 사용 비율 -->
                        <div class="category-budget-section" id="categoryBudgetSection">
                            <div class="category-budget-header">
                                <h4>카테고리별 사용 비율</h4>
                            </div>
                            <div class="category-budget-list" id="categoryBudgetList">
                                <!-- 카테고리가 없는 경우 -->
                                <div class="category-budget-empty" th:if="${#lists.isEmpty(categoryBudgetSummary)}">
                                    <p>등록된 일정이 없습니다.</p>
                                    <p>일정을 추가하면 카테고리별 예산이 자동 집계됩니다.</p>
                                </div>
                                <!-- 카테고리별 항목들 -->
                                <div class="category-budget-item" th:each="item : ${categoryBudgetSummary}">
                                    <div class="category-budget-item-header">
                                        <span class="category-budget-name" th:classappend="${item.categoryClassName}"
                                              th:text="${item.categoryEmoji} + ' ' + ${item.categoryName}">카테고리</span>
                                        <span class="category-budget-amount currency-amount"
                                              th:data-krw="${item.amount}"
                                              th:text="'₩' + ${#numbers.formatInteger(item.amount, 1, 'COMMA')}">₩0</span>
                                    </div>
                                    <div class="category-budget-bar">
                                        <div class="category-budget-fill"
                                             th:classappend="${item.categoryClassName}"
                                             th:style="'width: ' + ${T(java.lang.Math).min(item.percent, 100)} + '%'"></div>
                                    </div>
                                    <div class="category-budget-percent"
                                         th:text="${item.percent} + '%'">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- 일정 추가 모달 -->
<div th:fragment="plannerDetailModals" id="addItineraryModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2>일정 추가</h2>
            <button type="button" class="btn-modal-close" onclick="closeAddItineraryModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <form id="addItineraryForm">
                <div class="form-group">
                    <label for="itineraryTime">시간</label>
                    <input type="time" id="itineraryTime" name="time">
                </div>
                <div class="form-group">
                    <label for="itineraryTitle">제목 *</label>
                    <input type="text" id="itineraryTitle" name="title" required placeholder="일정 제목">
                </div>
                <div class="form-group">
                    <label for="itineraryLocation">위치</label>
                    <input type="text" id="itineraryLocation" name="location" placeholder="주소 또는 장소명">
                </div>
                <div class="form-group">
                    <label for="itineraryCategory">카테고리</label>
                    <select id="itineraryCategory" name="category">
                        <option value="ATTRACTION">관광지</option>
                        <option value="RESTAURANT">식당</option>
                        <option value="ACCOMMODATION">숙소</option>
                        <option value="TRANSPORT">교통</option>
                        <option value="SHOPPING">쇼핑</option>
                        <option value="OTHER">기타</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="itineraryNotes">메모</label>
                    <textarea id="itineraryNotes" name="notes" rows="3" placeholder="추가 메모"></textarea>
                </div>
                <div class="form-group">
                    <label for="itineraryCost">예상 비용 (₩)</label>
                    <input type="number" id="itineraryCost" name="cost" min="0" value="0" placeholder="원화로 입력">
                </div>
                <div class="form-group">
                    <label for="itineraryImage">사진 (선택)</label>
                    <div class="itinerary-image-upload">
                        <input type="file" id="itineraryImage" name="image"
                               accept="image/jpeg,image/png,image/webp,image/gif"
                               onchange="previewItineraryImage(this, 'add')" style="display: none;">
                        <div class="itinerary-image-preview" id="addImagePreview" onclick="document.getElementById('itineraryImage').click()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                            <span>클릭하여 이미지 선택</span>
                        </div>
                        <button type="button" class="btn-remove-itinerary-image" id="btnRemoveAddImage" onclick="removeItineraryImage('add')" style="display: none;">
                            이미지 삭제
                        </button>
                    </div>
                    <input type="hidden" id="itineraryImageUrl" name="imageUrl" value="">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-modal-cancel" onclick="closeAddItineraryModal()">취소</button>
            <button type="button" class="btn-modal-confirm" onclick="submitAddItinerary()">추가</button>
        </div>
    </div>
</div>

<!-- 일정 수정 모달 -->
<div th:fragment="editItineraryModal" id="editItineraryModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2>일정 수정</h2>
            <button type="button" class="btn-modal-close" onclick="closeEditItineraryModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <form id="editItineraryForm">
                <input type="hidden" id="editItineraryId">
                <div class="form-group">
                    <label for="editItineraryTime">시간</label>
                    <input type="time" id="editItineraryTime" name="time">
                </div>
                <div class="form-group">
                    <label for="editItineraryTitle">제목 *</label>
                    <input type="text" id="editItineraryTitle" name="title" required placeholder="일정 제목">
                </div>
                <div class="form-group">
                    <label for="editItineraryLocation">위치</label>
                    <input type="text" id="editItineraryLocation" name="location" placeholder="주소 또는 장소명">
                </div>
                <div class="form-group">
                    <label for="editItineraryCategory">카테고리</label>
                    <select id="editItineraryCategory" name="category">
                        <option value="ATTRACTION">관광지</option>
                        <option value="RESTAURANT">식당</option>
                        <option value="ACCOMMODATION">숙소</option>
                        <option value="TRANSPORT">교통</option>
                        <option value="SHOPPING">쇼핑</option>
                        <option value="OTHER">기타</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editItineraryNotes">메모</label>
                    <textarea id="editItineraryNotes" name="notes" rows="3" placeholder="추가 메모"></textarea>
                </div>
                <div class="form-group">
                    <label for="editItineraryCost">예상 비용 (₩)</label>
                    <div class="cost-input-wrapper">
                        <span class="cost-currency">₩</span>
                        <input type="number" id="editItineraryCost" name="cost" min="0" value="0" placeholder="원화로 입력">
                    </div>
                </div>
                <div class="form-group">
                    <label for="editItineraryImage">사진 (선택)</label>
                    <div class="itinerary-image-upload">
                        <input type="file" id="editItineraryImage" name="image"
                               accept="image/jpeg,image/png,image/webp,image/gif"
                               onchange="previewItineraryImage(this, 'edit')" style="display: none;">
                        <div class="itinerary-image-preview" id="editImagePreview" onclick="document.getElementById('editItineraryImage').click()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21 15 16 10 5 21"/>
                            </svg>
                            <span>클릭하여 이미지 선택</span>
                        </div>
                        <button type="button" class="btn-remove-itinerary-image" id="btnRemoveEditImage" onclick="removeItineraryImage('edit')" style="display: none;">
                            이미지 삭제
                        </button>
                    </div>
                    <input type="hidden" id="editItineraryImageUrl" name="imageUrl" value="">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-modal-cancel" onclick="closeEditItineraryModal()">취소</button>
            <button type="button" class="btn-modal-confirm" onclick="submitEditItinerary()">저장</button>
        </div>
    </div>
</div>

<!-- 공유 모달 -->
<div th:fragment="shareModal" id="shareModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2>플래너 공유하기</h2>
            <button type="button" class="btn-modal-close" onclick="closeShareModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div class="share-settings">
                <div class="share-settings-header">
                    <h4>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        공유된 사용자
                    </h4>
                </div>

                <div class="share-add-form">
                    <input type="text" id="shareUsername" placeholder="사용자 아이디 입력">
                    <select id="sharePermission">
                        <option value="VIEW">보기만</option>
                        <option value="EDIT">편집 가능</option>
                    </select>
                    <button type="button" onclick="addShare()">추가</button>
                </div>

                <div class="share-list" id="shareList">
                    <div class="share-empty">공유된 사용자가 없습니다.</div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-modal-cancel" onclick="closeShareModal()">닫기</button>
        </div>
    </div>
</div>
